import { NextRequest, NextResponse } from 'next/server';
import { AIChatbot, ChatContext } from '@/app/utils/ai-chatbot';

// GET: R√©cup√©rer les messages d'un utilisateur
export async function GET(request: NextRequest) {
  try {
    const { searchParams } = new URL(request.url);
    const userId = searchParams.get('userId');
    const contactId = searchParams.get('contactId');

    if (!userId) {
      return NextResponse.json({ error: 'User ID requis' }, { status: 400 });
    }

    // Si on demande les contacts
    if (!contactId) {
      const contacts = [
        {
          id: 'support',
          name: 'Support BE STRONG',
          avatar: '/support-avatar.png',
          lastMessage: 'Bonjour ! Comment puis-je vous aider ?',
          lastMessageTime: new Date(Date.now() - 1000 * 60 * 30),
          unreadCount: 0,
          isOnline: true
        },
        {
          id: 'community',
          name: 'Communaut√© BE STRONG',
          avatar: '/community-avatar.png',
          lastMessage: 'Nouveau d√©fi disponible !',
          lastMessageTime: new Date(Date.now() - 1000 * 60 * 60 * 2),
          unreadCount: 0,
          isOnline: false
        }
      ];

      return NextResponse.json({ contacts });
    }

    // Si on demande les messages d'un contact sp√©cifique
    return NextResponse.json({ messages: [] });

  } catch (error) {
    console.error('Erreur API messages GET:', error);
    return NextResponse.json({ error: 'Erreur serveur' }, { status: 500 });
  }
}

// POST: Envoyer un message
export async function POST(request: NextRequest) {
  try {
    const body = await request.json();
    const { senderId, receiverId, content, type = 'text' } = body;

    if (!senderId || !receiverId || !content) {
      return NextResponse.json({ error: 'senderId, receiverId et content requis' }, { status: 400 });
    }

    // Cr√©er le message de l'utilisateur
    const userMessage = {
      id: Date.now().toString(),
      from_user: senderId,
      to_user: receiverId,
      message: content,
      type: type,
      created_at: new Date().toISOString()
    };

    // Cr√©er un contexte utilisateur de base
    const userContext: ChatContext = {
      userId: senderId,
      userLevel: 1,
      userCredits: 100,
      userStreak: 3,
      lastMessages: [],
      conversationHistory: []
    };

    // G√©n√©rer une r√©ponse automatique intelligente avec l'IA avanc√©e
    let autoReplyContent: string;
    let autoReplyChoices: any[] = [];
    
    // Si c'est un choix de quiz, g√©n√©rer une r√©ponse sp√©ciale
    if (type === 'quiz' && content.startsWith('Quiz choice:')) {
      const choice = content.replace('Quiz choice: ', '');
      const quizResponse = generateQuizResponse(choice, receiverId);
      autoReplyContent = quizResponse.content;
      autoReplyChoices = quizResponse.choices || [];
    } else {
      try {
        // Utiliser l'IA avanc√©e
        autoReplyContent = await AIChatbot.generateContextualResponse(content, receiverId, userContext);
      } catch (aiError) {
        console.error('Erreur IA avanc√©e, utilisation du syst√®me de base:', aiError);
        // Fallback vers un syst√®me simple
        autoReplyContent = generateSimpleResponse(content, receiverId);
      }
    }
    
    // Cr√©er la r√©ponse automatique
    const autoReply = {
      id: (Date.now() + 1).toString(),
      from_user: receiverId,
      to_user: senderId,
      message: autoReplyContent,
      type: 'text',
      created_at: new Date().toISOString(),
      choices: autoReplyChoices
    };

    return NextResponse.json({
      success: true,
      message: userMessage,
      autoReply: autoReply
    });

  } catch (error) {
    console.error('Erreur API messages POST:', error);
    return NextResponse.json({ error: 'Erreur serveur' }, { status: 500 });
  }
}

// Fonction de fallback simple enrichie
function generateSimpleResponse(message: string, contactId: string): string {
  const lowerMessage = message.toLowerCase();
  
  if (contactId === 'support') {
    // Salutations
    if (lowerMessage.includes('bonjour') || lowerMessage.includes('salut') || lowerMessage.includes('hello') || 
        lowerMessage.includes('hi') || lowerMessage.includes('coucou') || lowerMessage.includes('bonsoir')) {
      return "Bonjour ! Je suis l'assistant virtuel de BE STRONG. Comment puis-je vous aider aujourd'hui ? üòä";
    }
    
    // Cr√©dits et monnaie
    if (lowerMessage.includes('cr√©dit') || lowerMessage.includes('credit') || lowerMessage.includes('argent') || 
        lowerMessage.includes('monnaie') || lowerMessage.includes('gagner') || lowerMessage.includes('obtenir')) {
      return "Les cr√©dits sont la monnaie virtuelle de BE STRONG. Vous en gagnez en compl√©tant des t√¢ches et des d√©fis ! üí∞";
    }
    
    // T√¢ches et missions
    if (lowerMessage.includes('t√¢che') || lowerMessage.includes('tache') || lowerMessage.includes('mission') || 
        lowerMessage.includes('activit√©') || lowerMessage.includes('objectif')) {
      return "Les t√¢ches sont des activit√©s quotidiennes qui vous aident √† progresser. Vous les trouvez dans votre tableau de bord ! üìã";
    }
    
    // D√©fis et challenges
    if (lowerMessage.includes('d√©fi') || lowerMessage.includes('defi') || lowerMessage.includes('challenge') || 
        lowerMessage.includes('comp√©tition') || lowerMessage.includes('tournoi')) {
      return "Les d√©fis sont des objectifs sp√©ciaux avec des r√©compenses importantes ! üèÜ";
    }
    
    // Badges et r√©compenses
    if (lowerMessage.includes('badge') || lowerMessage.includes('r√©compense') || lowerMessage.includes('recompense') || 
        lowerMessage.includes('troph√©e') || lowerMessage.includes('m√©daille')) {
      return "Les badges sont des r√©compenses que vous d√©bloquez en atteignant certains objectifs ! üéñÔ∏è";
    }
    
    // Tableau de bord
    if (lowerMessage.includes('tableau') || lowerMessage.includes('dashboard') || lowerMessage.includes('profil') || 
        lowerMessage.includes('statistiques') || lowerMessage.includes('stats')) {
      return "Le tableau de bord est accessible depuis le bouton 'Tableau de bord' en haut de la page ! üìä";
    }
    
    // Connexion
    if (lowerMessage.includes('connexion') || lowerMessage.includes('connecter') || lowerMessage.includes('login') || 
        lowerMessage.includes('se connecter') || lowerMessage.includes('mot de passe')) {
      return "Pour vous connecter, utilisez votre num√©ro de t√©l√©phone et votre mot de passe ! üîê";
    }
    
    // Probl√®mes techniques
    if (lowerMessage.includes('probl√®me') || lowerMessage.includes('erreur') || lowerMessage.includes('bug') || 
        lowerMessage.includes('marche pas') || lowerMessage.includes('dysfonctionnement')) {
      return "Je suis d√©sol√© pour ce probl√®me. Pouvez-vous me donner plus de d√©tails ? üîß";
    }
    
    // Paiements
    if (lowerMessage.includes('payer') || lowerMessage.includes('paiement') || lowerMessage.includes('abonnement') || 
        lowerMessage.includes('premium') || lowerMessage.includes('tarif')) {
      return "BE STRONG propose des abonnements premium avec des fonctionnalit√©s avanc√©es ! üí≥";
    }
    
    // Inscription
    if (lowerMessage.includes('inscription') || lowerMessage.includes('inscrire') || lowerMessage.includes('compte') || 
        lowerMessage.includes('cr√©er') || lowerMessage.includes('nouveau')) {
      return "Pour vous inscrire, cliquez sur le bouton 'S'inscrire' en haut √† droite de la page d'accueil ! üéâ";
    }
    
    // R√©seaux sociaux
    if (lowerMessage.includes('tiktok') || lowerMessage.includes('instagram') || lowerMessage.includes('youtube') || 
        lowerMessage.includes('r√©seau') || lowerMessage.includes('social')) {
      return "BE STRONG vous aide √† optimiser votre pr√©sence sur tous les r√©seaux sociaux ! üì±";
    }
    
    // Cr√©ation de contenu
    if (lowerMessage.includes('contenu') || lowerMessage.includes('vid√©o') || lowerMessage.includes('photo') || 
        lowerMessage.includes('cr√©er') || lowerMessage.includes('publier')) {
      return "BE STRONG vous aide √† cr√©er du contenu de qualit√© ! üé¨";
    }
    
    // Audience et followers
    if (lowerMessage.includes('followers') || lowerMessage.includes('abonn√©s') || lowerMessage.includes('audience') || 
        lowerMessage.includes('vues') || lowerMessage.includes('likes')) {
      return "D√©veloppez votre audience avec BE STRONG ! üë•";
    }
    
    // Questions sur BE STRONG
    if (lowerMessage.includes('be strong') || lowerMessage.includes('qu\'est-ce') || lowerMessage.includes('c\'est quoi') || 
        lowerMessage.includes('d√©finition') || lowerMessage.includes('explication')) {
      return "BE STRONG est une plateforme qui vous aide √† maximiser votre pr√©sence sur les r√©seaux sociaux ! üí™";
    }
    
    // Merci
    if (lowerMessage.includes('merci') || lowerMessage.includes('thanks')) {
      return "De rien ! C'est un plaisir de vous aider ! üòä";
    }
    
    return "Merci pour votre message ! Notre √©quipe de support vous r√©pondra dans les plus brefs d√©lais. üìû";
  }
  
  if (contactId === 'community') {
    // Questions sur la communaut√©
    if (lowerMessage.includes('communaut√©') || lowerMessage.includes('communaute') || lowerMessage.includes('membre') || 
        lowerMessage.includes('groupe') || lowerMessage.includes('√©quipe')) {
      return "Bienvenue dans la communaut√© BE STRONG ! Nous sommes une communaut√© de cr√©ateurs qui s'entraident ! üë•";
    }
    
    // D√©fis communautaires
    if (lowerMessage.includes('d√©fi') || lowerMessage.includes('defi') || lowerMessage.includes('challenge') || 
        lowerMessage.includes('comp√©tition') || lowerMessage.includes('tournoi')) {
      return "Un nouveau d√©fi communautaire est disponible ! Rejoignez d'autres membres ! üéØ";
    }
    
    // √âv√©nements
    if (lowerMessage.includes('√©v√©nement') || lowerMessage.includes('evenement') || lowerMessage.includes('live') || 
        lowerMessage.includes('direct') || lowerMessage.includes('stream')) {
      return "Nous organisons r√©guli√®rement des √©v√©nements en direct avec des experts ! üìÖ";
    }
    
    // Conseils
    if (lowerMessage.includes('conseil') || lowerMessage.includes('astuce') || lowerMessage.includes('tip') || 
        lowerMessage.includes('suggestion') || lowerMessage.includes('aide')) {
      return "La communaut√© partage quotidiennement des conseils et astuces ! üí°";
    }
    
    return "Merci pour votre message ! La communaut√© BE STRONG est l√† pour vous soutenir ! üåü";
  }
  
  return "Merci pour votre message ! Notre √©quipe vous r√©pondra dans les plus brefs d√©lais.";
} 

// Fonction pour g√©n√©rer des r√©ponses de quiz
function generateQuizResponse(choice: string, contactId: string): { content: string, choices?: any[] } {
  const responses: { [key: string]: { content: string, choices?: any[] } } = {
    credits: {
      content: "üí∞ **Les cr√©dits BE STRONG**\n\nLes cr√©dits sont votre monnaie virtuelle ! Vous en gagnez en :\n‚Ä¢ Compl√©tant des t√¢ches quotidiennes\n‚Ä¢ Relevants des d√©fis\n‚Ä¢ Participant √† la communaut√©\n\nQue voulez-vous savoir sur les cr√©dits ?",
      choices: [
        { id: 'earn', text: 'üí° Comment en gagner plus ?', action: 'earn_credits' },
        { id: 'use', text: 'üõí Comment les utiliser ?', action: 'use_credits' },
        { id: 'next', text: '‚û°Ô∏è Passer au suivant', action: 'next_topic' }
      ]
    },
    tasks: {
      content: "üìã **Les t√¢ches quotidiennes**\n\nLes t√¢ches sont vos objectifs quotidiens pour progresser ! Elles vous rapportent :\n‚Ä¢ Des cr√©dits\n‚Ä¢ De l'exp√©rience\n‚Ä¢ Des badges\n\nQue voulez-vous d√©couvrir ?",
      choices: [
        { id: 'daily', text: 'üìÖ T√¢ches quotidiennes', action: 'daily_tasks' },
        { id: 'weekly', text: 'üìä T√¢ches hebdomadaires', action: 'weekly_tasks' },
        { id: 'next', text: '‚û°Ô∏è Passer au suivant', action: 'next_topic' }
      ]
    },
    challenges: {
      content: "üèÜ **Les d√©fis sp√©ciaux**\n\nLes d√©fis sont des objectifs plus difficiles mais avec de meilleures r√©compenses !\n\nIls incluent :\n‚Ä¢ Des comp√©titions\n‚Ä¢ Des r√©compenses exclusives\n‚Ä¢ Des badges rares",
      choices: [
        { id: 'current', text: 'üéØ D√©fis actuels', action: 'current_challenges' },
        { id: 'rewards', text: 'üéÅ R√©compenses', action: 'challenge_rewards' },
        { id: 'next', text: '‚û°Ô∏è Passer au suivant', action: 'next_topic' }
      ]
    },
    social: {
      content: "üì± **R√©seaux sociaux**\n\nBE STRONG vous aide √† optimiser votre pr√©sence sur :\n‚Ä¢ TikTok\n‚Ä¢ Instagram\n‚Ä¢ YouTube\n‚Ä¢ Et plus encore !\n\nQue voulez-vous apprendre ?",
      choices: [
        { id: 'tiktok', text: 'üéµ TikTok', action: 'tiktok_tips' },
        { id: 'instagram', text: 'üì∏ Instagram', action: 'instagram_tips' },
        { id: 'youtube', text: 'üé¨ YouTube', action: 'youtube_tips' },
        { id: 'next', text: '‚û°Ô∏è Passer au suivant', action: 'next_topic' }
      ]
    },
    help: {
      content: "‚ùì **Besoin d'aide ?**\n\nJe suis l√† pour vous aider ! Que souhaitez-vous faire ?",
      choices: [
        { id: 'account', text: 'üë§ Mon compte', action: 'account_help' },
        { id: 'technical', text: 'üîß Probl√®me technique', action: 'technical_help' },
        { id: 'contact', text: 'üìû Contacter l\'√©quipe', action: 'contact_team' }
      ]
    },
    earn_credits: {
      content: "üí° **Comment gagner plus de cr√©dits ?**\n\nVoici les meilleures fa√ßons :\n\n1Ô∏è‚É£ **T√¢ches quotidiennes** : +10-50 cr√©dits/jour\n2Ô∏è‚É£ **D√©fis sp√©ciaux** : +100-500 cr√©dits\n3Ô∏è‚É£ **Participation communautaire** : +5-25 cr√©dits\n4Ô∏è‚É£ **Streak quotidien** : Bonus progressif\n5Ô∏è‚É£ **Inviter des amis** : +50 cr√©dits/ami\n\nVoulez-vous en savoir plus ?",
      choices: [
        { id: 'use_credits', text: 'üõí Comment utiliser mes cr√©dits ?', action: 'use_credits' },
        { id: 'next', text: '‚û°Ô∏è Passer au suivant', action: 'next_topic' }
      ]
    },
    use_credits: {
      content: "üõí **Comment utiliser vos cr√©dits ?**\n\nVos cr√©dits vous permettent de :\n\nüé® **Fonctionnalit√©s premium**\n‚Ä¢ Outils de montage avanc√©s\n‚Ä¢ Templates exclusifs\n‚Ä¢ Analyses d√©taill√©es\n\nüéÅ **R√©compenses sp√©ciales**\n‚Ä¢ Badges rares\n‚Ä¢ Avatars personnalis√©s\n‚Ä¢ Acc√®s VIP\n\nüíé **Abonnements**\n‚Ä¢ R√©ductions sur les abonnements\n‚Ä¢ Contenu exclusif\n‚Ä¢ Support prioritaire",
      choices: [
        { id: 'next', text: '‚û°Ô∏è Passer au suivant', action: 'next_topic' }
      ]
    },
    daily_tasks: {
      content: "üìÖ **T√¢ches quotidiennes**\n\nChaque jour, vous avez acc√®s √† :\n\nüåÖ **T√¢ches matinales** (6h-12h)\n‚Ä¢ Poster une story\n‚Ä¢ Interagir avec 5 posts\n‚Ä¢ Compl√©ter un mini-d√©fi\n\nüåÜ **T√¢ches d'apr√®s-midi** (12h-18h)\n‚Ä¢ Cr√©er du contenu\n‚Ä¢ Participer √† un challenge\n‚Ä¢ Aider un autre membre\n\nüåô **T√¢ches du soir** (18h-24h)\n‚Ä¢ Analyser vos statistiques\n‚Ä¢ Planifier le lendemain\n‚Ä¢ Partager vos succ√®s",
      choices: [
        { id: 'weekly_tasks', text: 'üìä T√¢ches hebdomadaires', action: 'weekly_tasks' },
        { id: 'next', text: '‚û°Ô∏è Passer au suivant', action: 'next_topic' }
      ]
    },
    weekly_tasks: {
      content: "üìä **T√¢ches hebdomadaires**\n\nChaque semaine, des objectifs plus ambitieux :\n\nüéØ **Objectifs de croissance**\n‚Ä¢ Gagner 100 nouveaux followers\n‚Ä¢ Cr√©er 7 posts de qualit√©\n‚Ä¢ Atteindre 1000 vues totales\n\nüèÜ **D√©fis sp√©ciaux**\n‚Ä¢ Participer √† un concours\n‚Ä¢ Collaborer avec un autre cr√©ateur\n‚Ä¢ Cr√©er un contenu viral\n\nüìà **Analyses approfondies**\n‚Ä¢ Revoir vos performances\n‚Ä¢ Optimiser votre strat√©gie\n‚Ä¢ Planifier la semaine suivante",
      choices: [
        { id: 'next', text: '‚û°Ô∏è Passer au suivant', action: 'next_topic' }
      ]
    },
    current_challenges: {
      content: "üéØ **D√©fis actuels**\n\nVoici les d√©fis en cours :\n\nüî• **D√©fi Viral** (7 jours)\n‚Ä¢ Cr√©er un contenu qui atteint 10k vues\n‚Ä¢ R√©compense : 500 cr√©dits + badge \"Viral\"\n\nüí™ **D√©fi Streak** (30 jours)\n‚Ä¢ √ätre actif 30 jours cons√©cutifs\n‚Ä¢ R√©compense : 1000 cr√©dits + badge \"D√©termin√©\"\n\nüåü **D√©fi Communaut√©** (14 jours)\n‚Ä¢ Aider 50 autres membres\n‚Ä¢ R√©compense : 300 cr√©dits + badge \"Bienveillant\"\n\nVoulez-vous participer ?",
      choices: [
        { id: 'challenge_rewards', text: 'üéÅ Voir toutes les r√©compenses', action: 'challenge_rewards' },
        { id: 'next', text: '‚û°Ô∏è Passer au suivant', action: 'next_topic' }
      ]
    },
    challenge_rewards: {
      content: "üéÅ **R√©compenses des d√©fis**\n\nLes d√©fis offrent des r√©compenses exceptionnelles :\n\nüí∞ **Cr√©dits**\n‚Ä¢ D√©fis simples : 50-200 cr√©dits\n‚Ä¢ D√©fis moyens : 200-500 cr√©dits\n‚Ä¢ D√©fis difficiles : 500-1000+ cr√©dits\n\nüèÖ **Badges exclusifs**\n‚Ä¢ Badges anim√©s\n‚Ä¢ Badges rares\n‚Ä¢ Badges de collection\n\nüéØ **Acc√®s VIP**\n‚Ä¢ Contenu exclusif\n‚Ä¢ Outils premium\n‚Ä¢ Support prioritaire\n\nüåü **Reconnaissance**\n‚Ä¢ Profil mis en avant\n‚Ä¢ Mentions sp√©ciales\n‚Ä¢ Opportunit√©s de collaboration",
      choices: [
        { id: 'next', text: '‚û°Ô∏è Passer au suivant', action: 'next_topic' }
      ]
    },
    tiktok_tips: {
      content: "üéµ **Conseils TikTok**\n\nPour r√©ussir sur TikTok :\n\nüì± **Optimisation du contenu**\n‚Ä¢ Vid√©os courtes (15-60 secondes)\n‚Ä¢ D√©but accrocheur (3 premi√®res secondes)\n‚Ä¢ Hashtags populaires mais pertinents\n‚Ä¢ Sons tendance\n\n‚è∞ **Timing optimal**\n‚Ä¢ 12h-14h (pause d√©jeuner)\n‚Ä¢ 18h-22h (soir√©e)\n‚Ä¢ Week-ends (plus d'engagement)\n\nüéØ **Strat√©gie de croissance**\n‚Ä¢ Poster 1-3 fois par jour\n‚Ä¢ Interagir avec les commentaires\n‚Ä¢ Collaborer avec d'autres cr√©ateurs\n‚Ä¢ Analyser vos statistiques",
      choices: [
        { id: 'instagram_tips', text: 'üì∏ Conseils Instagram', action: 'instagram_tips' },
        { id: 'youtube_tips', text: 'üé¨ Conseils YouTube', action: 'youtube_tips' },
        { id: 'next', text: '‚û°Ô∏è Passer au suivant', action: 'next_topic' }
      ]
    },
    instagram_tips: {
      content: "üì∏ **Conseils Instagram**\n\nPour maximiser votre pr√©sence Instagram :\n\nüì∑ **Contenu de qualit√©**\n‚Ä¢ Photos avec bonne lumi√®re\n‚Ä¢ Stories engageantes\n‚Ä¢ Reels courts et dynamiques\n‚Ä¢ IGTV pour du contenu long\n\nüìä **Strat√©gie de publication**\n‚Ä¢ 1-2 posts par jour\n‚Ä¢ Stories quotidiennes\n‚Ä¢ Reels 3-4 fois par semaine\n‚Ä¢ Lives r√©guliers\n\nüéØ **Engagement**\n‚Ä¢ R√©pondre aux commentaires\n‚Ä¢ Utiliser les sondages Stories\n‚Ä¢ Collaborer avec des influenceurs\n‚Ä¢ Participer aux tendances",
      choices: [
        { id: 'youtube_tips', text: 'üé¨ Conseils YouTube', action: 'youtube_tips' },
        { id: 'next', text: '‚û°Ô∏è Passer au suivant', action: 'next_topic' }
      ]
    },
    youtube_tips: {
      content: "üé¨ **Conseils YouTube**\n\nPour r√©ussir sur YouTube :\n\nüé• **Qualit√© du contenu**\n‚Ä¢ Thumbnails accrocheurs\n‚Ä¢ Titres optimis√©s SEO\n‚Ä¢ Descriptions d√©taill√©es\n‚Ä¢ Tags pertinents\n\n‚è±Ô∏è **Optimisation**\n‚Ä¢ Vid√©os de 8-15 minutes\n‚Ä¢ R√©tention d'audience > 60%\n‚Ä¢ Call-to-action dans les vid√©os\n‚Ä¢ Playlists th√©matiques\n\nüìà **Croissance**\n‚Ä¢ Posting r√©gulier (2-3 fois/semaine)\n‚Ä¢ Collaboration avec d'autres cr√©ateurs\n‚Ä¢ Promotion cross-platform\n‚Ä¢ Analyse des analytics",
      choices: [
        { id: 'next', text: '‚û°Ô∏è Passer au suivant', action: 'next_topic' }
      ]
    },
    account_help: {
      content: "üë§ **Aide pour votre compte**\n\nBesoin d'aide avec votre compte ?\n\nüîê **Connexion**\n‚Ä¢ Mot de passe oubli√©\n‚Ä¢ Probl√®me de connexion\n‚Ä¢ Changement d'email/t√©l√©phone\n\n‚öôÔ∏è **Param√®tres**\n‚Ä¢ Modification du profil\n‚Ä¢ Changement de mot de passe\n‚Ä¢ Param√®tres de confidentialit√©\n\nüì± **Application**\n‚Ä¢ Probl√®me technique\n‚Ä¢ Bug ou dysfonctionnement\n‚Ä¢ Mise √† jour n√©cessaire",
      choices: [
        { id: 'technical_help', text: 'üîß Probl√®me technique', action: 'technical_help' },
        { id: 'contact_team', text: 'üìû Contacter l\'√©quipe', action: 'contact_team' }
      ]
    },
    technical_help: {
      content: "üîß **Aide technique**\n\nProbl√®me technique ? Voici les solutions :\n\nüì± **Probl√®mes courants**\n‚Ä¢ Rafra√Æchir la page\n‚Ä¢ Vider le cache\n‚Ä¢ Red√©marrer l'application\n‚Ä¢ V√©rifier votre connexion\n\nüîÑ **Solutions rapides**\n‚Ä¢ Se d√©connecter/reconnecter\n‚Ä¢ Utiliser un autre navigateur\n‚Ä¢ D√©sactiver les extensions\n‚Ä¢ V√©rifier les mises √† jour\n\nüìû **Si le probl√®me persiste**\n‚Ä¢ D√©crivez le probl√®me en d√©tail\n‚Ä¢ Incluez des captures d'√©cran\n‚Ä¢ Pr√©cisez votre appareil/navigateur",
      choices: [
        { id: 'contact_team', text: 'üìû Contacter l\'√©quipe', action: 'contact_team' }
      ]
    },
    contact_team: {
      content: "üìû **Contacter l'√©quipe**\n\nNotre √©quipe est l√† pour vous aider !\n\nüìß **Par email**\n‚Ä¢ support@bestrong.com\n‚Ä¢ R√©ponse sous 24h\n\nüí¨ **Chat en direct**\n‚Ä¢ Disponible 7j/7\n‚Ä¢ 9h-18h (heure fran√ßaise)\n\nüì± **R√©seaux sociaux**\n‚Ä¢ Instagram : @bestrong_support\n‚Ä¢ Twitter : @BE_STRONG_Help\n\n‚è∞ **Temps de r√©ponse**\n‚Ä¢ Urgences : < 2h\n‚Ä¢ Questions g√©n√©rales : < 24h\n‚Ä¢ Suggestions : < 48h",
      choices: [
        { id: 'next', text: '‚û°Ô∏è Retour au menu', action: 'next_topic' }
      ]
    },
    next_topic: {
      content: "Parfait ! Que souhaitez-vous explorer maintenant ?",
      choices: [
        { id: 'credits', text: 'üí∞ Les cr√©dits et r√©compenses', action: 'credits' },
        { id: 'tasks', text: 'üìã Les t√¢ches quotidiennes', action: 'tasks' },
        { id: 'challenges', text: 'üèÜ Les d√©fis sp√©ciaux', action: 'challenges' },
        { id: 'social', text: 'üì± R√©seaux sociaux', action: 'social' },
        { id: 'finish', text: '‚úÖ J\'ai fini, merci !', action: 'finish_quiz' }
      ]
    },
    finish_quiz: {
      content: "üéâ Parfait ! Vous connaissez maintenant les bases de BE STRONG !\n\nN'h√©sitez pas √† revenir si vous avez d'autres questions. Bonne continuation ! üòä",
      choices: [
        { id: 'restart', text: 'üîÑ Recommencer le quiz', action: 'restart_quiz' },
        { id: 'chat', text: 'üí¨ Chat libre', action: 'free_chat' }
      ]
    },
    restart_quiz: {
      content: "üîÑ **Quiz red√©marr√© !**\n\nQue souhaitez-vous explorer en premier ?",
      choices: [
        { id: 'credits', text: 'üí∞ Les cr√©dits et r√©compenses', action: 'credits' },
        { id: 'tasks', text: 'üìã Les t√¢ches quotidiennes', action: 'tasks' },
        { id: 'challenges', text: 'üèÜ Les d√©fis sp√©ciaux', action: 'challenges' },
        { id: 'social', text: 'üì± R√©seaux sociaux', action: 'social' },
        { id: 'help', text: '‚ùì J\'ai besoin d\'aide', action: 'help' }
      ]
    },
    free_chat: {
      content: "üí¨ **Chat libre activ√© !**\n\nVous pouvez maintenant me poser toutes vos questions librement. Je suis l√† pour vous aider ! üòä",
      choices: []
    }
  };
  
  return responses[choice] || {
    content: "Merci pour votre choix ! Que souhaitez-vous faire maintenant ?",
    choices: [
      { id: 'next', text: '‚û°Ô∏è Continuer', action: 'next_topic' },
      { id: 'finish', text: '‚úÖ Terminer', action: 'finish_quiz' }
    ]
  };
} 